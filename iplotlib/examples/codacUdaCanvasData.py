"""
Demonstrate usage of iplotlib by plotting data obtained from a CODAC-UDA server, including setting canvas parameters.
"""

import os
import tempfile

from iplotDataAccess.dataAccess import DataAccess
from iplotlib.core import Canvas, PlotXY, LinearAxis
from iplotlib.interface import IplotSignalAdapter, StatusInfo, AccessHelper

dscfg = """[codacuda]
conninfo=host=io-ls-udasrv1.iter.org,port=3090
varprefix=
rturl=http://io-ls-udaweb1.iter.org/dashboard/backend/sse
rtheaders=REMOTE_USER:$USERNAME,User-Agent:python_client
rtauth=None
default=true
"""


def plot():
    da = DataAccess()

    with tempfile.NamedTemporaryFile(mode='w+') as fp:
        fp.write(dscfg)
        fp.seek(0)
        os.environ.update({'IPLOT_SOURCES_CONFIG': os.path.abspath(fp.name)})
        if da.load_config(fp.name):
            AccessHelper.da = da
            c = Canvas(rows=4,
                       cols=1,
                       title=os.path.basename(__file__).replace('.py', ''),
                       font_size=None,
                       font_color='#000000',
                       background_color='#FFFFFF',
                       tick_number=7,
                       round_hour=False,
                       line_style=None,
                       line_size=None,
                       marker=None,
                       marker_size=None,
                       step=None,
                       hi_precision_data=False,
                       dec_samples=1000,
                       legend=True,
                       legend_position='upper right',
                       legend_layout='vertical',
                       grid=True,
                       ticks_position=False,
                       mouse_mode='MM_SELECT',
                       enable_Xlabel_crosshair=True,
                       enable_Ylabel_crosshair=True,
                       enable_ValLabel_crosshair=True,
                       plots=[
                           [
                               PlotXY(row_span=1,
                                      col_span=1,
                                      title=None,
                                      axes=[
                                          LinearAxis(label=None,
                                                     font_size=None,
                                                     font_color='#000000',
                                                     tick_number=7,
                                                     _type='iplotlib.core.axis.LinearAxis',
                                                     original_begin=1713195380000000000,
                                                     original_end=1713800180000000000,
                                                     begin=1713195380000000000,
                                                     end=1713800180000000000,
                                                     is_date=True,
                                                     window=None,
                                                     follow=False),
                                          [
                                              LinearAxis(label=None,
                                                         font_size=None,
                                                         font_color='#000000',
                                                         tick_number=7,
                                                         _type='iplotlib.core.axis.LinearAxis',
                                                         original_begin=651.3888916015627,
                                                         original_end=783.7962890625003,
                                                         begin=651.3888916015627,
                                                         end=783.7962890625003,
                                                         is_date=False,
                                                         window=None,
                                                         follow=False)
                                          ]
                                      ],
                                      signals={
                                          1: [
                                              IplotSignalAdapter(uid='779ade72-80aa-4f91-bd11-4b8f710ef6ce',
                                                                 name='CWS-SCSU-HR00:ML0004-LT-XI',
                                                                 label='CWS-SCSU-HR00:ML0004-LT-XI',
                                                                 color='#1f77b4',
                                                                 line_style=None,
                                                                 line_size=None,
                                                                 marker=None,
                                                                 marker_size=None,
                                                                 step=None,
                                                                 hi_precision_data=False,
                                                                 plot_type='PlotXY',
                                                                 _type='iplotlib.interface.iplotSignalAdapter.IplotSignalAdapter',
                                                                 data_source='codacuda',
                                                                 alias='',
                                                                 pulse_nb='',
                                                                 ts_start=1713195380000000000,
                                                                 ts_end=1713800180000000000,
                                                                 ts_relative=False,
                                                                 envelope='',
                                                                 isDownsampled=True,
                                                                 x_expr='${self}.time',
                                                                 y_expr='${self}.data_store[1]',
                                                                 z_expr='${self}.data_store[2]',
                                                                 children=[

                                                                 ],
                                                                 status_info=StatusInfo(msg='',
                                                                                        num_points=1931,
                                                                                        result='Success',
                                                                                        stage='Processing',
                                                                                        inf=0),
                                                                 data_access_enabled=True,
                                                                 processing_enabled=True,
                                                                 time_out_value=60)
                                          ]
                                      },
                                      _type='iplotlib.core.plot.PlotXY',
                                      font_size=None,
                                      font_color='#000000',
                                      background_color='#FFFFFF',
                                      tick_number=7,
                                      legend=None,
                                      legend_position='same as canvas',
                                      legend_layout='same as canvas',
                                      grid=None,
                                      line_style=None,
                                      line_size=None,
                                      marker=None,
                                      marker_size=None,
                                      step=None,
                                      hi_precision_data=None,
                                      dec_samples=None,
                                      _color_index=0),
                               PlotXY(row_span=1,
                                      col_span=1,
                                      title=None,
                                      axes=[
                                          LinearAxis(label=None,
                                                     font_size=None,
                                                     font_color='#000000',
                                                     tick_number=7,
                                                     _type='iplotlib.core.axis.LinearAxis',
                                                     original_begin=1713195380000000000,
                                                     original_end=1713800180000000000,
                                                     begin=1713195380000000000,
                                                     end=1713800180000000000,
                                                     is_date=True,
                                                     window=None,
                                                     follow=False),
                                          [
                                              LinearAxis(label=None,
                                                         font_size=None,
                                                         font_color='#000000',
                                                         tick_number=7,
                                                         _type='iplotlib.core.axis.LinearAxis',
                                                         original_begin=653.1250061035154,
                                                         original_end=798.2639099121096,
                                                         begin=653.1250061035154,
                                                         end=798.2639099121096,
                                                         is_date=False,
                                                         window=None,
                                                         follow=False)
                                          ]
                                      ],
                                      signals={
                                          1: [
                                              IplotSignalAdapter(uid='0aee3b92-00d4-4160-adaf-781f4c88193b',
                                                                 name='CWS-SCSU-HR00:ML0002-LT-XI',
                                                                 label='CWS-SCSU-HR00:ML0002-LT-XI',
                                                                 color='#1f77b4',
                                                                 line_style=None,
                                                                 line_size=None,
                                                                 marker=None,
                                                                 marker_size=None,
                                                                 step=None,
                                                                 hi_precision_data=False,
                                                                 plot_type='PlotXY',
                                                                 _type='iplotlib.interface.iplotSignalAdapter.IplotSignalAdapter',
                                                                 data_source='codacuda',
                                                                 alias='',
                                                                 pulse_nb='',
                                                                 ts_start=1713195380000000000,
                                                                 ts_end=1713800180000000000,
                                                                 ts_relative=False,
                                                                 envelope='',
                                                                 isDownsampled=False,
                                                                 x_expr='${self}.time',
                                                                 y_expr='${self}.data_store[1]',
                                                                 z_expr='${self}.data_store[2]',
                                                                 children=[

                                                                 ],
                                                                 status_info=StatusInfo(msg='',
                                                                                        num_points=90331,
                                                                                        result='Success',
                                                                                        stage='Processing',
                                                                                        inf=0),
                                                                 data_access_enabled=True,
                                                                 processing_enabled=True,
                                                                 time_out_value=60)
                                          ]
                                      },
                                      _type='iplotlib.core.plot.PlotXY',
                                      font_size=None,
                                      font_color='#000000',
                                      background_color='#FFFFFF',
                                      tick_number=7,
                                      legend=None,
                                      legend_position='same as canvas',
                                      legend_layout='same as canvas',
                                      grid=None,
                                      line_style=None,
                                      line_size=None,
                                      marker=None,
                                      marker_size=None,
                                      step=None,
                                      hi_precision_data=None,
                                      dec_samples=None,
                                      _color_index=0),
                               PlotXY(row_span=1,
                                      col_span=1,
                                      title=None,
                                      axes=[
                                          LinearAxis(label=None,
                                                     font_size=None,
                                                     font_color='#000000',
                                                     tick_number=7,
                                                     _type='iplotlib.core.axis.LinearAxis',
                                                     original_begin=1713195380000000000,
                                                     original_end=1713800180000000000,
                                                     begin=1713195380000000000,
                                                     end=1713800180000000000,
                                                     is_date=True,
                                                     window=None,
                                                     follow=False),
                                          [
                                              LinearAxis(label=None,
                                                         font_size=None,
                                                         font_color='#000000',
                                                         tick_number=7,
                                                         _type='iplotlib.core.axis.LinearAxis',
                                                         original_begin=4885.185229492187,
                                                         original_end=5068.518383789063,
                                                         begin=4885.185229492187,
                                                         end=5068.518383789063,
                                                         is_date=False,
                                                         window=None,
                                                         follow=False)
                                          ]
                                      ],
                                      signals={
                                          1: [
                                              IplotSignalAdapter(uid='c4883c96-298c-4be8-91d8-de2ad66520ad',
                                                                 name='CWS-SCSU-HR00:ML0001-LT-XI',
                                                                 label='CWS-SCSU-HR00:ML0001-LT-XI',
                                                                 color='#1f77b4',
                                                                 line_style=None,
                                                                 line_size=None,
                                                                 marker=None,
                                                                 marker_size=None,
                                                                 step=None,
                                                                 hi_precision_data=False,
                                                                 plot_type='PlotXY',
                                                                 _type='iplotlib.interface.iplotSignalAdapter.IplotSignalAdapter',
                                                                 data_source='codacuda',
                                                                 alias='',
                                                                 pulse_nb='',
                                                                 ts_start=1713195380000000000,
                                                                 ts_end=1713800180000000000,
                                                                 ts_relative=False,
                                                                 envelope='',
                                                                 isDownsampled=True,
                                                                 x_expr='${self}.time',
                                                                 y_expr='${self}.data_store[1]',
                                                                 z_expr='${self}.data_store[2]',
                                                                 children=[

                                                                 ],
                                                                 status_info=StatusInfo(msg='',
                                                                                        num_points=1922,
                                                                                        result='Success',
                                                                                        stage='Processing',
                                                                                        inf=0),
                                                                 data_access_enabled=True,
                                                                 processing_enabled=True,
                                                                 time_out_value=60)
                                          ]
                                      },
                                      _type='iplotlib.core.plot.PlotXY',
                                      font_size=None,
                                      font_color='#000000',
                                      background_color='#FFFFFF',
                                      tick_number=7,
                                      legend=None,
                                      legend_position='same as canvas',
                                      legend_layout='same as canvas',
                                      grid=None,
                                      line_style=None,
                                      line_size=None,
                                      marker=None,
                                      marker_size=None,
                                      step=None,
                                      hi_precision_data=None,
                                      dec_samples=None,
                                      _color_index=0),
                               PlotXY(row_span=1,
                                      col_span=1,
                                      title=None,
                                      axes=[
                                          LinearAxis(label=None,
                                                     font_size=None,
                                                     font_color='#000000',
                                                     tick_number=7,
                                                     _type='iplotlib.core.axis.LinearAxis',
                                                     original_begin=1713195380000000000,
                                                     original_end=1713800180000000000,
                                                     begin=1713195380000000000,
                                                     end=1713800180000000000,
                                                     is_date=True,
                                                     window=None,
                                                     follow=False),
                                          [
                                              LinearAxis(label=None,
                                                         font_size=None,
                                                         font_color='#000000',
                                                         tick_number=7,
                                                         _type='iplotlib.core.axis.LinearAxis',
                                                         original_begin=4857.06015625,
                                                         original_end=5048.0326171875,
                                                         begin=4857.06015625,
                                                         end=5048.0326171875,
                                                         is_date=False,
                                                         window=None,
                                                         follow=False)
                                          ]
                                      ],
                                      signals={
                                          1: [
                                              IplotSignalAdapter(uid='6825e4ad-c71c-42a7-a393-370f3f978a39',
                                                                 name='CWS-SCSU-HR00:ML0003-LT-XI',
                                                                 label='CWS-SCSU-HR00:ML0003-LT-XI',
                                                                 color='#1f77b4',
                                                                 line_style=None,
                                                                 line_size=None,
                                                                 marker=None,
                                                                 marker_size=None,
                                                                 step=None,
                                                                 hi_precision_data=False,
                                                                 plot_type='PlotXY',
                                                                 _type='iplotlib.interface.iplotSignalAdapter.IplotSignalAdapter',
                                                                 data_source='codacuda',
                                                                 alias='',
                                                                 pulse_nb='',
                                                                 ts_start=1713195380000000000,
                                                                 ts_end=1713800180000000000,
                                                                 ts_relative=False,
                                                                 envelope='',
                                                                 isDownsampled=True,
                                                                 x_expr='${self}.time',
                                                                 y_expr='${self}.data_store[1]',
                                                                 z_expr='${self}.data_store[2]',
                                                                 children=[

                                                                 ],
                                                                 status_info=StatusInfo(msg='',
                                                                                        num_points=1924,
                                                                                        result='Success',
                                                                                        stage='Processing',
                                                                                        inf=0),
                                                                 data_access_enabled=True,
                                                                 processing_enabled=True,
                                                                 time_out_value=60)
                                          ]
                                      },
                                      _type='iplotlib.core.plot.PlotXY',
                                      font_size=None,
                                      font_color='#000000',
                                      background_color='#FFFFFF',
                                      tick_number=7,
                                      legend=None,
                                      legend_position='same as canvas',
                                      legend_layout='same as canvas',
                                      grid=None,
                                      line_style=None,
                                      line_size=None,
                                      marker=None,
                                      marker_size=None,
                                      step=None,
                                      hi_precision_data=None,
                                      dec_samples=None,
                                      _color_index=0)
                           ]
                       ],
                       focus_plot=None,
                       crosshair_enabled=False,
                       crosshair_color='red',
                       crosshair_line_width=1,
                       crosshair_horizontal=True,
                       crosshair_vertical=True,
                       crosshair_per_plot=False,
                       streaming=False,
                       shared_x_axis=False,
                       autoscale=True,
                       full_mode_all_stack=True,
                       auto_refresh=0,
                       _type='iplotlib.core.canvas.Canvas')

            canvas_II = Canvas(rows=1,
                               cols=1,
                               title="",
                               font_size=None,
                               font_color='#000000',
                               background_color='#FFFFFF',
                               tick_number=7,
                               round_hour=False,
                               line_style=None,
                               line_size=None,
                               marker=None,
                               marker_size=None,
                               step=None,
                               hi_precision_data=False,
                               dec_samples=1000,
                               legend=True,
                               legend_position='upper right',
                               legend_layout='vertical',
                               grid=True,
                               ticks_position=False,
                               mouse_mode='MM_SELECT',
                               enable_Xlabel_crosshair=True,
                               enable_Ylabel_crosshair=True,
                               enable_ValLabel_crosshair=True,
                               plots=[
                                   [
                                       PlotXY(row_span=1,
                                              col_span=1,
                                              title=None,
                                              axes=[
                                                  LinearAxis(label=None,
                                                             font_size=None,
                                                             font_color=None,
                                                             tick_number=7,
                                                             _type='iplotlib.core.axis.LinearAxis',
                                                             original_begin=1637947680000000000,
                                                             original_end=1638552480000000000,
                                                             begin=1637947680000000000,
                                                             end=1638552480000000000,
                                                             is_date=True,
                                                             window=None,
                                                             follow=False),
                                                  [
                                                      LinearAxis(label=None,
                                                                 font_size=None,
                                                                 font_color=None,
                                                                 tick_number=7,
                                                                 _type='iplotlib.core.axis.LinearAxis',
                                                                 original_begin=None,
                                                                 original_end=None,
                                                                 begin=-1.5649476800162316,
                                                                 end=32.86390128034086,
                                                                 is_date=False,
                                                                 window=None,
                                                                 follow=False)
                                                  ]
                                              ],
                                              signals={
                                                  1: [
                                                      IplotSignalAdapter(uid=None,
                                                                         name='CWS-SCSU-HR00:MTE0098-TT-XI',
                                                                         label='mte098filtered',
                                                                         color='#1f77b4',
                                                                         line_style=None,
                                                                         line_size=None,
                                                                         marker=None,
                                                                         marker_size=None,
                                                                         step=None,
                                                                         hi_precision_data=None,
                                                                         plot_type='PlotXY',
                                                                         _type='iplotlib.interface.iplotSignalAdapter.IplotSignalAdapter',
                                                                         data_source='codacuda',
                                                                         alias='mte098filtered',
                                                                         pulse_nb='',
                                                                         ts_start=1637947680000000000,
                                                                         ts_end=1638552480000000000,
                                                                         ts_relative=False,
                                                                         envelope='',
                                                                         isDownsampled=False,
                                                                         x_expr='${self}.time[np.nonzero(${self}.data>0)]',
                                                                         y_expr='${self}.data_store[1][${self}.data>0]',
                                                                         z_expr='${self}.data_store[2]',
                                                                         children=[

                                                                         ],
                                                                         status_info=StatusInfo(msg='',
                                                                                                num_points=0,
                                                                                                result='Ready',
                                                                                                stage='Initialization',
                                                                                                inf=0),
                                                                         data_access_enabled=True,
                                                                         processing_enabled=True,
                                                                         time_out_value=60),
                                                      IplotSignalAdapter(uid=None,
                                                                         name='${CWS-SCSU-HR00:MTE0101-TT-XI}+2.7',
                                                                         label='${CWS-SCSU-HR00:MTE0101-TT-XI}+2.7',
                                                                         color='#ff7f0e',
                                                                         line_style=None,
                                                                         line_size=None,
                                                                         marker=None,
                                                                         marker_size=None,
                                                                         step=None,
                                                                         hi_precision_data=None,
                                                                         plot_type='PlotXY',
                                                                         _type='iplotlib.interface.iplotSignalAdapter.IplotSignalAdapter',
                                                                         data_source='codacuda',
                                                                         alias='',
                                                                         pulse_nb='',
                                                                         ts_start=1637947680000000000,
                                                                         ts_end=1638552480000000000,
                                                                         ts_relative=False,
                                                                         envelope='',
                                                                         isDownsampled=False,
                                                                         x_expr='${self}.time',
                                                                         y_expr='${self}.data_store[1]',
                                                                         z_expr='${self}.data_store[2]',
                                                                         children=[
                                                                             IplotSignalAdapter(uid=None,
                                                                                                name='CWS-SCSU-HR00:MTE0101-TT-XI',
                                                                                                label='',
                                                                                                color=None,
                                                                                                line_style=None,
                                                                                                line_size=None,
                                                                                                marker=None,
                                                                                                marker_size=None,
                                                                                                step=None,
                                                                                                hi_precision_data=None,
                                                                                                plot_type='PlotXY',
                                                                                                _type='iplotlib.interface.iplotSignalAdapter.IplotSignalAdapter',
                                                                                                data_source='codacuda',
                                                                                                alias='',
                                                                                                pulse_nb='',
                                                                                                ts_start=1637947680000000000,
                                                                                                ts_end=1638552480000000000,
                                                                                                ts_relative=False,
                                                                                                envelope='',
                                                                                                isDownsampled=False,
                                                                                                x_expr='${self}.time',
                                                                                                y_expr='${self}.data_store[1]',
                                                                                                z_expr='${self}.data_store[2]',
                                                                                                children=[

                                                                                                ],
                                                                                                status_info=StatusInfo(
                                                                                                    msg='',
                                                                                                    num_points=0,
                                                                                                    result='Ready',
                                                                                                    stage='Initialization',
                                                                                                    inf=0),
                                                                                                data_access_enabled=True,
                                                                                                processing_enabled=True,
                                                                                                time_out_value=60),
                                                                             IplotSignalAdapter(uid=None,
                                                                                                name='CWS-SCSU-HR00:MTE0101-TT-XI',
                                                                                                label='',
                                                                                                color='#ff7f0e',
                                                                                                line_style=None,
                                                                                                line_size=None,
                                                                                                marker=None,
                                                                                                marker_size=None,
                                                                                                step=None,
                                                                                                hi_precision_data=None,
                                                                                                plot_type='PlotXY',
                                                                                                _type='iplotlib.interface.iplotSignalAdapter.IplotSignalAdapter',
                                                                                                data_source='codacuda',
                                                                                                alias='',
                                                                                                pulse_nb='',
                                                                                                ts_start=1637947680000000000,
                                                                                                ts_end=1638552480000000000,
                                                                                                ts_relative=False,
                                                                                                envelope='',
                                                                                                isDownsampled=False,
                                                                                                x_expr='${self}.time',
                                                                                                y_expr='${self}.data_store[1]',
                                                                                                z_expr='${self}.data_store[2]',
                                                                                                children=[

                                                                                                ],
                                                                                                status_info=StatusInfo(
                                                                                                    msg='',
                                                                                                    num_points=0,
                                                                                                    result='Ready',
                                                                                                    stage='Initialization',
                                                                                                    inf=0),
                                                                                                data_access_enabled=True,
                                                                                                processing_enabled=True,
                                                                                                time_out_value=60)
                                                                         ],
                                                                         status_info=StatusInfo(msg='',
                                                                                                num_points=0,
                                                                                                result='Ready',
                                                                                                stage='Initialization',
                                                                                                inf=0),
                                                                         data_access_enabled=True,
                                                                         processing_enabled=True,
                                                                         time_out_value=60),
                                                      IplotSignalAdapter(uid=None,
                                                                         name='CWS-SCSU-HR00:MTE0098-TT-XI',
                                                                         label='CWS-SCSU-HR00:MTE0098-TT-XI',
                                                                         color='#2ca02c',
                                                                         line_style=None,
                                                                         line_size=None,
                                                                         marker=None,
                                                                         marker_size=None,
                                                                         step=None,
                                                                         hi_precision_data=None,
                                                                         plot_type='PlotXY',
                                                                         _type='iplotlib.interface.iplotSignalAdapter.IplotSignalAdapter',
                                                                         data_source='codacuda',
                                                                         alias='',
                                                                         pulse_nb='',
                                                                         ts_start=1637947680000000000,
                                                                         ts_end=1638552480000000000,
                                                                         ts_relative=False,
                                                                         envelope='',
                                                                         isDownsampled=False,
                                                                         x_expr='${self}.time',
                                                                         y_expr='${self}.data_store[1]',
                                                                         z_expr='${self}.data_store[2]',
                                                                         children=[

                                                                         ],
                                                                         status_info=StatusInfo(msg='',
                                                                                                num_points=0,
                                                                                                result='Ready',
                                                                                                stage='Initialization',
                                                                                                inf=0),
                                                                         data_access_enabled=True,
                                                                         processing_enabled=True,
                                                                         time_out_value=60)
                                                  ]
                                              },
                                              _type='iplotlib.core.plot.PlotXY',
                                              font_size=None,
                                              font_color=None,
                                              background_color='#FFFFFF',
                                              tick_number=7,
                                              legend=None,
                                              legend_position='same as canvas',
                                              legend_layout='same as canvas',
                                              grid=None,
                                              line_style=None,
                                              line_size=None,
                                              marker=None,
                                              marker_size=None,
                                              step=None,
                                              hi_precision_data=None,
                                              dec_samples=None,
                                              _color_index=0)
                                   ]
                               ],
                               focus_plot=None,
                               crosshair_enabled=False,
                               crosshair_color='red',
                               crosshair_line_width=1,
                               crosshair_horizontal=True,
                               crosshair_vertical=True,
                               crosshair_per_plot=False,
                               streaming=False,
                               shared_x_axis=False,
                               autoscale=True,
                               full_mode_all_stack=True,
                               auto_refresh=0,
                               _type='iplotlib.core.canvas.Canvas')

            return c
